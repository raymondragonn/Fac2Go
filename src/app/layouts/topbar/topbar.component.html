<div class="topbar d-print-none">
  <div class="container-fluid">
    <nav
      class="topbar-custom d-flex justify-content-between"
      [class.nav-sticky]="scrollY > 50"
      id="topbar-custom"
    >
      <ul
        class="topbar-item list-unstyled d-inline-flex align-items-center mb-0"
      >
        <li>
          <button
            (click)="toggleMobileMenu()"
            class="nav-link mobile-menu-btn nav-icon"
            id="togglemenu"
          >
            <i class="iconoir-menu"></i>
          </button>
        </li>
      </ul>
      <ul
        class="topbar-item list-unstyled d-inline-flex align-items-center mb-0"
      >
        <!--<li class="dropdown topbar-item" ngbDropdown>
          <a
            class="nav-link dropdown-toggle arrow-none nav-icon"
            ngbDropdownToggle
            data-bs-toggle="dropdown"
            href="javascript:void(0);"
            role="button"
            aria-haspopup="false"
            aria-expanded="false"
          >
            <img
              src="assets/images/flags/us_flag.jpg"
              alt=""
              class="thumb-sm rounded-circle"
            />
          </a>
          <div class="dropdown-menu stop" ngbDropdownMenu>
            <a class="dropdown-item" href="javascript:void(0);"
              ><img
                src="assets/images/flags/us_flag.jpg"
                alt=""
                height="15"
                class="me-2"
              />English</a
            >
            <a class="dropdown-item" href="javascript:void(0);"
              ><img
                src="assets/images/flags/spain_flag.jpg"
                alt=""
                height="15"
                class="me-2"
              />Spanish</a
            >
            <a class="dropdown-item" href="javascript:void(0);"
              ><img
                src="assets/images/flags/germany_flag.jpg"
                alt=""
                height="15"
                class="me-2"
              />German</a
            >
            <a class="dropdown-item" href="javascript:void(0);"
              ><img
                src="assets/images/flags/french_flag.jpg"
                alt=""
                height="15"
                class="me-2"
              />French</a
            >
          </div>
        </li>-->
        <!--end topbar-language-->

        <!--<li class="topbar-item">
          <a
            class="nav-link nav-icon"
            (click)="changeTheme()"
            href="javascript:void(0);"
            id="light-dark-mode"
          >
            <i class="iconoir-half-moon dark-mode"></i>
            <i class="iconoir-sun-light light-mode"></i>
          </a>
        </li>-->

        <!--<li class="dropdown topbar-item" ngbDropdown [placement]="'bottom-end'">
          <a
            class="nav-link dropdown-toggle arrow-none nav-icon"
            ngbDropdownToggle
            data-bs-toggle="dropdown"
            href="javascript:void(0);"
            role="button"
            aria-haspopup="false"
            aria-expanded="false"
          >
            <i class="iconoir-bell"></i>
            <span class="alert-badge"></span>
          </a>
          <div
            class="dropdown-menu stop dropdown-menu-end dropdown-lg py-0"
            ngbDropdownMenu
          >
            <h5
              class="dropdown-item-text m-0 py-3 d-flex justify-content-between align-items-center"
            >
              Notifications
              <a
                href="javascript:void(0);"
                class="badge text-body-tertiary badge-pill"
              >
                <i class="iconoir-plus-circle fs-4"></i>
              </a>
            </h5>
            <ul
              ngbNav
              #nav="ngbNav"
              class="nav nav-tabs nav-tabs-custom nav-success nav-justified mb-1"
              role="tablist"
            >
              @for (tab of tabItems; track $index) {
                <li class="nav-item" role="presentation" ngbNavItem>
                  <a
                    class="nav-link mx-0"
                    ngbNavLink
                    data-bs-toggle="tab"
                    href="javascript:void(0);"
                    role="tab"
                  >
                    {{ tab.tabName }}
                    @if ($index == 0) {
                      <span
                        class="badge bg-primary-subtle text-primary badge-pill ms-1"
                      >
                        24
                      </span>
                    }
                  </a>
                  <ng-template ngbNavContent>
                    <div class="tab-pane fade show active" role="tabpanel">
                      @for (item of tab.tabContent; track $index) {
                        <a
                          href="javascript:void(0);"
                          class="dropdown-item py-3"
                        >
                          <small class="float-end text-muted ps-2">{{
                            item.time
                          }}</small>
                          <div class="d-flex align-items-center">
                            <div
                              class="flex-shrink-0 bg-primary-subtle text-primary thumb-md rounded-circle"
                            >
                              <i [class]="item.iconClass + ' fs-4'"></i>
                            </div>
                            <div class="flex-grow-1 ms-2 text-truncate">
                              <h6 class="my-0 fw-normal text-dark fs-13">
                                {{ item.title }}
                              </h6>
                              <small class="text-muted mb-0">{{
                                item.description
                              }}</small>
                            </div>
                          </div>
                        </a>
                      }
                    </div>
                  </ng-template>
                </li>
              }
            </ul>
            <ngx-simplebar class="ms-0" style="max-height: 230px">
              <div
                class="tab-content"
                id="myTabContent"
                [ngbNavOutlet]="nav"
              ></div>
            </ngx-simplebar>
            <a
              routerLink="/pages/notifications"
              class="dropdown-item text-center text-dark fs-13 py-2"
            >
              View All <i class="fi-arrow-right"></i>
            </a>
          </div>
        </li>-->

        <li class="dropdown topbar-item" ngbDropdown placement="bottom-end">
          <a
            ngbDropdownToggle
            data-bs-toggle="dropdown"
            href="javascript:void(0);"
            role="button"
            class="d-flex align-items-center"
          >
            @if (userType === 'guest') {
              <div class="d-flex align-items-center">
                <div class="text-center">
                  <h6 class="my-0 text-dark fs-18 fw-semibold">Bienvenido a Fac2Go</h6>
                  <small class="text-dark">Plataforma de Facturación</small>
                </div>
              </div>
            } @else {
              <h6 class="my-0 text-dark fs-18">{{ getDisplayName() }}</h6>
            }
          </a>

          <!--MENU DESPLEGABLE EN TOPBAR-->
          <div class="dropdown-menu dropdown-menu-end py-2 stop" ngbDropdownMenu>
            @if (userType === 'guest') {
              <div class="d-flex align-items-center dropdown-item py-3 bg-primary-subtle">
                <div class="flex-grow-1 text-center">
                  <h5 class="my-0 fw-semibold text-primary mb-1">Bienvenido a Fac2Go</h5>
                  <p class="text-muted mb-0">Tu plataforma de facturación inteligente</p>
                </div>
              </div>

              <div class="dropdown-divider mt-0"></div>
              <div class="px-3 py-2">
                <h6 class="text-muted mb-2 fs-15">¿Ya tienes una cuenta?</h6>
                <a class="dropdown-item d-flex align-items-center py-2" routerLink="/auth/login-user">
                  <div class="flex-shrink-0 bg-primary-subtle text-primary rounded-circle p-2 me-2">
                    <i class="las la-sign-in-alt fs-20"></i>
                  </div>
                  <div class="flex-grow-1">
                    <h6 class="my-0 fw-medium text-dark fs-15">Iniciar sesión</h6>
                    <small class="text-muted fs-13">Accede a tu cuenta de usuario</small>
                  </div>
                </a>
              </div>
              
              <div class="px-3 py-2">
                <h6 class="text-muted mb-2 fs-15">¿Eres nuevo?</h6>
                <a class="dropdown-item d-flex align-items-center py-2" routerLink="/auth/register-user">
                  <div class="flex-shrink-0 bg-success-subtle text-success rounded-circle p-2 me-2">
                    <i class="las la-user-plus fs-20"></i>
                  </div>
                  <div class="flex-grow-1">
                    <h6 class="my-0 fw-medium text-dark fs-15">Crear cuenta</h6>
                    <small class="text-muted fs-13">Únete a nuestra comunidad</small>
                  </div>
                </a>
              </div>

              <div class="px-3 py-2">
                <h6 class="text-muted mb-2 fs-15">Acceso Administrativo</h6>
                <a class="dropdown-item d-flex align-items-center py-2" routerLink="/auth/login-admin">
                  <div class="flex-shrink-0 bg-dark-subtle text-dark rounded-circle p-2 me-2">
                    <i class="las la-user-shield fs-20"></i>
                  </div>
                  <div class="flex-grow-1">
                    <h6 class="my-0 fw-medium text-dark fs-15">Panel Administrativo</h6>
                    <small class="text-muted fs-13">Acceso exclusivo para administradores</small>
                  </div>
                </a>
              </div>
            } @else {
              <div class="d-flex align-items-center dropdown-item py-2 bg-secondary-subtle">
                <div class="flex-shrink-0"></div>
                <div class="flex-grow-1 ms-2 text-truncate align-self-center">
                  <h6 class="my-0 fw-medium text-dark fs-13">{{ getDisplayName() }}</h6>
                  <small class="text-muted mb-0">{{ userEmail }}</small>
                  <small class="text-primary d-block">{{ userType === 'admin' ? 'Administrador' : userType === 'user' ? 'Usuario' : 'Invitado' }}</small>
                </div>
              </div>

              <!-- Mostrar opciones según el tipo de usuario -->
              <div *ngIf="userType === 'user' || userType === 'admin'">
                <div class="dropdown-divider mt-0"></div>
                <div class="px-3 py-2">
                  <h6 class="text-muted mb-2 fs-15">Gestión de cuenta</h6>
                  <a class="dropdown-item d-flex align-items-center py-2" routerLink="/pages/profile">
                    <div class="flex-shrink-0 bg-info-subtle text-info rounded-circle p-2 me-2">
                      <i class="las la-user fs-20"></i>
                    </div>
                    <div class="flex-grow-1">
                      <h6 class="my-0 fw-medium text-dark fs-15">Mi perfil</h6>
                      <small class="text-muted fs-13">Gestiona tu información personal</small>
                    </div>
                  </a>
                </div>

                <div class="px-3 py-2">
                  <a class="dropdown-item d-flex align-items-center py-2" routerLink="/" (click)="logout()">
                    <div class="flex-shrink-0 bg-danger-subtle text-danger rounded-circle p-2 me-2">
                      <i class="las la-power-off fs-20"></i>
                    </div>
                    <div class="flex-grow-1">
                      <h6 class="my-0 fw-medium text-dark fs-15">Cerrar sesión</h6>
                      <small class="text-muted fs-13">Salir de tu cuenta</small>
                    </div>
                  </a>
                </div>
              </div>
            }
          </div>
        </li>
      </ul>
      <!--end topbar-nav-->
    </nav>
    <!-- end navbar-->
  </div>
</div>
